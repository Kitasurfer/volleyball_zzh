# üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

**–ü—Ä–æ–µ–∫—Ç**: `volleyball` (kxwmkvtxkaczuonnnxlj)  
**–†–µ–≥–∏–æ–Ω**: EU North 1  
**–î–∞—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: 9 –Ω–æ—è–±—Ä—è 2025

---

## üìä –¢–∞–±–ª–∏—Ü—ã

### 1. **content_items** (4 –∑–∞–ø–∏—Å–∏)
–•—Ä–∞–Ω–∏—Ç —Å—Ç–∞—Ç—å–∏, –Ω–æ–≤–æ—Å—Ç–∏, –ø—Ä–∞–≤–∏–ª–∞ –≤–æ–ª–µ–π–±–æ–ª–∞.

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK) ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `title` (text) ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫
- `slug` (text) ‚Äî URL-–∞–¥—Ä–µ—Å (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è —è–∑—ã–∫–∞)
- `language` (text) ‚Äî —è–∑—ã–∫ (de/en/ru)
- `status` (text) ‚Äî —Å—Ç–∞—Ç—É—Å (draft/published)
- `type` (text) ‚Äî —Ç–∏–ø (article/news/announcement)
- `summary` (text) ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `body_markdown` (text) ‚Äî —Ç–µ–∫—Å—Ç –≤ Markdown
- `body_html` (text) ‚Äî —Ç–µ–∫—Å—Ç –≤ HTML
- `tags` (text[]) ‚Äî —Ç–µ–≥–∏
- `author_id` (uuid) ‚Äî –∞–≤—Ç–æ—Ä
- `published_at` (timestamptz) ‚Äî –¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `created_at`, `updated_at` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

**–ò–Ω–¥–µ–∫—Å—ã**:
- `slug`, `type`, `status`

---

### 2. **media_assets** (0 –∑–∞–ø–∏—Å–µ–π)
–•—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤.

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK)
- `storage_path` (text, unique) ‚Äî –ø—É—Ç—å –≤ Storage
- `title` (text) ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ
- `description` (text) ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ
- `language` (text) ‚Äî —è–∑—ã–∫
- `media_type` (text) ‚Äî —Ç–∏–ø (image/video/audio/document)
- `width`, `height` (int) ‚Äî —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `duration_seconds` (numeric) ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ
- `metadata` (jsonb) ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `created_at`, `updated_at` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å

**–ò–Ω–¥–µ–∫—Å—ã**:
- `language`, `media_type`

---

### 3. **content_media_links** (0 –∑–∞–ø–∏—Å–µ–π)
–°–≤—è–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —Å –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏.

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK)
- `content_id` (uuid, FK ‚Üí content_items)
- `media_id` (uuid, FK ‚Üí media_assets)
- `role` (text) ‚Äî —Ä–æ–ª—å (inline/featured/gallery)
- `position` (int) ‚Äî –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `created_at` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å

---

### 4. **vector_jobs** (0 –∑–∞–ø–∏—Å–µ–π)
–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ AI-–ø–æ–∏—Å–∫.

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK)
- `content_id` (uuid, FK ‚Üí content_items)
- `status` (text) ‚Äî pending/processing/completed/failed
- `error` (text) ‚Äî —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- `payload` (jsonb) ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `started_at`, `completed_at` (timestamptz)
- `created_at`, `updated_at` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å

**–ò–Ω–¥–µ–∫—Å—ã**:
- `status`, `content_id`

---

### 5. **chat_sessions** (0 –∑–∞–ø–∏—Å–µ–π)
–°–µ—Å—Å–∏–∏ —á–∞—Ç–∞ —Å –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º–∏.

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK)
- `user_hash` (text) ‚Äî —Ö–µ—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `language` (text) ‚Äî —è–∑—ã–∫
- `metadata` (jsonb) ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `created_at`, `last_activity` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å
- ‚úÖ Service role –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å

**–ò–Ω–¥–µ–∫—Å—ã**:
- `user_hash`, `language`

---

### 6. **chat_messages** (0 –∑–∞–ø–∏—Å–µ–π)
–°–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ.

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK)
- `session_id` (uuid, FK ‚Üí chat_sessions)
- `role` (text) ‚Äî system/user/assistant/tool
- `content` (text) ‚Äî —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `citations` (jsonb) ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- `metadata` (jsonb) ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `created_at` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å
- ‚úÖ Service role –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å

**–ò–Ω–¥–µ–∫—Å—ã**:
- `(session_id, created_at)`

---

### 7. **contact_submissions** (0 –∑–∞–ø–∏—Å–µ–π)
–°–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π —Ñ–æ—Ä–º—ã.

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK)
- `name` (text) ‚Äî –∏–º—è
- `email` (text) ‚Äî email
- `message` (text) ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ
- `language` (text) ‚Äî —è–∑—ã–∫
- `created_at` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –õ—é–±–æ–π –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å

**–ò–Ω–¥–µ–∫—Å—ã**:
- `created_at DESC`

---

### 8. **admin_action_logs** (0 –∑–∞–ø–∏—Å–µ–π)
–ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (audit trail).

**–ö–æ–ª–æ–Ω–∫–∏**:
- `id` (uuid, PK)
- `admin_id` (uuid) ‚Äî ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `action` (text) ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ (create/update/delete)
- `target_table` (text) ‚Äî —Ç–∞–±–ª–∏—Ü–∞
- `target_id` (uuid) ‚Äî ID –∑–∞–ø–∏—Å–∏
- `payload` (jsonb) ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- `created_at` (timestamptz)

**RLS –ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å
- ‚úÖ Service role –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å

**–ò–Ω–¥–µ–∫—Å—ã**:
- `(admin_id, created_at DESC)`, `(target_table, target_id)`

---

## ü™£ Storage Buckets

### **media-public**
–ü—É–±–ª–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø: –î–∞
- ‚úÖ –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞: 50 MB
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã:
  - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: JPEG, PNG, GIF, WebP, SVG
  - –í–∏–¥–µ–æ: MP4, WebM
  - –ê—É–¥–∏–æ: MP3, WAV
  - –î–æ–∫—É–º–µ–Ω—Ç—ã: PDF

**–ü–æ–ª–∏—Ç–∏–∫–∏**:
- ‚úÖ –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å

---

## üîß –§—É–Ω–∫—Ü–∏–∏

### 1. **admin_retry_vector_job(job_id uuid)**
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–µ—É–¥–∞—á–Ω—É—é –∑–∞–¥–∞—á—É –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏.

**–ü—Ä–∞–≤–∞**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å `vector_jobs`

### 2. **admin_enqueue_vector_job(content_id uuid, reason text)**
–°—Ç–∞–≤–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –¥–ª—è AI-–ø–æ–∏—Å–∫–∞.

**–ü—Ä–∞–≤–∞**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –ù–æ–≤—É—é –∑–∞–ø–∏—Å—å `vector_jobs`

### 3. **set_updated_at()**
–¢—Ä–∏–≥–≥–µ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `updated_at`.

---

## üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- **Email**: `admin@zizishausen-volleyball.netlify.app`
- **ID**: `391cb1e5-9e34-4f01-8c3e-d11f659bc5ec`
- **–†–æ–ª—å**: `admin` ‚úÖ
- **App Metadata**: `{"role": "admin", "provider": "email", "providers": ["email"]}`
- **User Metadata**: `{"role": "admin", "email_verified": true}`
- **–°—Ç–∞—Ç—É—Å**: Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω ‚úÖ

---

## üîê Row Level Security (RLS)

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏:

### –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø:
- ‚úÖ –ß—Ç–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (`content_items`)
- ‚úÖ –ß—Ç–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ (`media_assets`)
- ‚úÖ –ß—Ç–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–¥–∏–∞ (`content_media_links`)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π —Ñ–æ—Ä–º—ã (`contact_submissions`)

### –ê–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø:
- ‚úÖ –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- ‚úÖ –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞
- ‚úÖ –ß—Ç–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ vector jobs
- ‚úÖ –ß—Ç–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö —Ñ–æ—Ä–º
- ‚úÖ –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π

### Service Role:
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ (–¥–ª—è Edge Functions)
- ‚úÖ –ó–∞–ø–∏—Å—å –ª–æ–≥–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏–∏

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `/supabase/migrations/`:

1. ‚úÖ `1762122873_enable_rls_contact_submissions.sql`
2. ‚úÖ `1762129000_create_content_and_chat_schema.sql`
3. ‚úÖ `1762129100_add_admin_rls_policies.sql`
4. ‚úÖ `1762129200_add_admin_retry_function.sql`
5. ‚úÖ `1762129300_admin_enqueue_vector_job.sql`
6. ‚úÖ `1762130000_add_volleyball_rules_content.sql`
7. ‚úÖ `1762130500_add_content_media_status_and_logs.sql`

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É
–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
- **Email**: `admin@zizishausen-volleyball.netlify.app`
- **–ü–∞—Ä–æ–ª—å**: `12345678`

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞
–í –∞–¥–º–∏–Ω–∫–µ (`/admin/content`) –Ω–∞–∂–º–∏—Ç–µ **"Ingest to AI search"** –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ 4 —Å—Ç–∞—Ç–µ–π –æ –ø—Ä–∞–≤–∏–ª–∞—Ö –≤–æ–ª–µ–π–±–æ–ª–∞.

### 3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã
–í –∞–¥–º–∏–Ω–∫–µ (`/admin/media`) –∑–∞–≥—Ä—É–∑–∏—Ç–µ PDF —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π | RLS | –ò–Ω–¥–µ–∫—Å—ã |
|---------|---------|-----|---------|
| content_items | 4 | ‚úÖ | 3 |
| media_assets | 0 | ‚úÖ | 2 |
| content_media_links | 0 | ‚úÖ | 1 |
| vector_jobs | 0 | ‚úÖ | 2 |
| chat_sessions | 0 | ‚úÖ | 2 |
| chat_messages | 0 | ‚úÖ | 1 |
| contact_submissions | 0 | ‚úÖ | 1 |
| admin_action_logs | 0 | ‚úÖ | 2 |

**–í—Å–µ–≥–æ**: 8 —Ç–∞–±–ª–∏—Ü, 4 –∑–∞–ø–∏—Å–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, 2 —Ñ—É–Ω–∫—Ü–∏–∏, 1 storage bucket

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 9 –Ω–æ—è–±—Ä—è 2025, 13:00
